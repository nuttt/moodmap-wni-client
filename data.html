<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<script src="js/jquery-2.1.1.min.js"></script>
	<script src="js/underscore-min.js"></script>
	<script>
	$(function(){
		$.ajax({
			url: "http://gsp.weathernews.jp/grpt6aa/gsp/tools/get_report_list.cgi",
			jsonp: "callback",
			dataType: "jsonp",
			success: function(response) {
				var filteredObjs = _.filter(response, function(report){ return (report['skyfeel'] != '' && report['location'] != '') });
				var sortedObjs = _.groupBy(filteredObjs, 'location');
				var results = [];
				var items = [];
				$.each(sortedObjs, function(city, cityReports) {
					skyfeel = [];
					foundLatLon = false;
					lat = '';
					lon = '';
					for(i in cityReports) {
						if(cityReports[i]['skyfeel']){
							skyfeel.push(cityReports[i]['skyfeel']);
						}
						if(!foundLatLon && cityReports[i]['lat'] != '0.000000' && cityReports[i]['lon'] != '0.000000'){
							lat = cityReports[i]['lat'];
							lon = cityReports[i]['lon'];
							foundLatLon = true;
						}
					}
					sum = _.reduce(skyfeel, function(memo, num){ return memo + parseInt(num); }, 0);
					avg = sum/skyfeel.length;
					results.push({
						'city': city,
						'lat': lat,
						'lon': lon,
						'skyfeel': avg,
						'reports': cityReports
					});
					results = _.filter(results, function(city){ return city['lat'] != '' && city['lon'] != '' });
				});
				console.log(results);
				// for(i in results) {
				// 	items.push('<li>' + results[i]['city'] + results[i]['lat'] + results[i]['lon'] + '</li>');
				// }
				// $( "<ul/>", {
				// 	"class": "my-new-list",
				// 	html: items.join("")
				// }).appendTo("body");
			}
		});
	});
	</script>
</body>
</html>